{% extends "dashboard_layout.html" %}

{% block content %}
<div class="p-6">
    <div class="flex items-center justify-between mb-6">
        <div>
            <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Fund Transfers</h1>
            <p class="text-gray-500 dark:text-gray-400">Transfer funds between accounts</p>
        </div>
    </div>

    <!-- Transfer Form -->
    <div class="bg-white rounded-lg shadow dark:bg-gray-800 p-6 mb-6">
        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">New Transfer</h3>
        <form method="POST" action="{{ url_for('banking.new_transfer') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="from_account_type" id="from_account_type" value="bank">
            <input type="hidden" name="to_account_type" id="to_account_type" value="bank">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label for="from_account_id" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">From Account *</label>
                    <select name="from_account_id" id="from_account_id" required
                            onchange="updateAccountType('from', this.value)"
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option value="">Select Account</option>
                        {% for acc in payment_accounts %}
                        <option value="{{ acc.id }}" data-type="{{ acc.type }}">{{ acc.name }} ({{ acc.type|title }}) - {{ "%.2f"|format(acc.balance or 0) }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="to_account_id" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">To Account *</label>
                    <select name="to_account_id" id="to_account_id" required
                            onchange="updateAccountType('to', this.value)"
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <option value="">Select Account</option>
                        {% for acc in payment_accounts %}
                        <option value="{{ acc.id }}" data-type="{{ acc.type }}">{{ acc.name }} ({{ acc.type|title }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="amount" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Amount *</label>
                    <input type="number" name="amount" id="amount" step="0.01" min="0" required
                           class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
                <div>
                    <label for="transfer_date" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Transfer Date *</label>
                    <input type="date" name="transfer_date" id="transfer_date" required
                           class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
                <div>
                    <label for="reference" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Reference</label>
                    <input type="text" name="reference" id="reference"
                           class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
                <div class="flex items-end">
                    <button type="submit" class="text-white bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800">
                        Transfer
                    </button>
                </div>
            </div>
            <div class="mt-4">
                <label for="description" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Description</label>
                <input type="text" name="description" id="description"
                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
            </div>
        </form>
    </div>

    <!-- Transfers History -->
    <div class="bg-white rounded-lg shadow dark:bg-gray-800">
        <div class="p-6 border-b dark:border-gray-700">
            <h3 class="text-lg font-medium text-gray-900 dark:text-white">Transfer History</h3>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th class="px-6 py-3">Transfer #</th>
                        <th class="px-6 py-3">Date</th>
                        <th class="px-6 py-3">From</th>
                        <th class="px-6 py-3">To</th>
                        <th class="px-6 py-3">Amount</th>
                        <th class="px-6 py-3">Reference</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transfer in transfers %}
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                        <td class="px-6 py-4 font-medium">{{ transfer.transfer_number }}</td>
                        <td class="px-6 py-4">{{ transfer.transfer_date }}</td>
                        <td class="px-6 py-4">
                            {{ transfer.from_account_name or 'N/A' }}
                            <span class="text-xs text-gray-400">({{ transfer.from_account_type|title if transfer.from_account_type else 'Bank' }})</span>
                        </td>
                        <td class="px-6 py-4">
                            {{ transfer.to_account_name or 'N/A' }}
                            <span class="text-xs text-gray-400">({{ transfer.to_account_type|title if transfer.to_account_type else 'Bank' }})</span>
                        </td>
                        <td class="px-6 py-4 font-medium">{{ "%.2f"|format(transfer.amount) }}</td>
                        <td class="px-6 py-4">{{ transfer.reference or '-' }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500 dark:text-gray-400">
                            No transfers recorded yet.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function updateAccountType(prefix, value) {
    const select = document.getElementById(prefix + '_account_id');
    const typeInput = document.getElementById(prefix + '_account_type');
    const selectedOption = select.options[select.selectedIndex];
    typeInput.value = selectedOption.getAttribute('data-type') || 'bank';
}

// Set today's date as default
document.addEventListener('DOMContentLoaded', function() {
    const dateInput = document.getElementById('transfer_date');
    if (dateInput && !dateInput.value) {
        dateInput.value = new Date().toISOString().split('T')[0];
    }
});
</script>
{% endblock %}
