{% extends "reports/pdf/base_pdf.html" %}

{% block content %}
<div class="report-title">General Ledger</div>
<div class="report-period">
    Account: {{ selected_account_name }}<br>
    Period: {{ start_date or 'All' }} to {{ end_date or 'Present' }}
</div>

<!-- Summary Box -->
{% if summary and summary.total_entries > 0 %}
<div class="summary-box">
    <div class="summary-row">
        <span class="summary-label">Total Debits:</span>
        <span class="summary-value" style="color: #059669;">{{ "%.2f"|format(summary.total_debit) }}</span>
    </div>
    <div class="summary-row">
        <span class="summary-label">Total Credits:</span>
        <span class="summary-value" style="color: #dc2626;">{{ "%.2f"|format(summary.total_credit) }}</span>
    </div>
    <div class="summary-row">
        <span class="summary-label">Net Movement:</span>
        <span class="summary-value" style="color: {% if summary.net_movement >= 0 %}#059669{% else %}#dc2626{% endif %};">
            {{ "%.2f"|format(summary.net_movement) }}
        </span>
    </div>
    <div class="summary-row">
        <span class="summary-label">Total Entries:</span>
        <span class="summary-value">{{ summary.total_entries }}</span>
    </div>
</div>
{% endif %}

<!-- Accounts Summary (if multiple accounts) -->
{% if summary and summary.accounts_summary and summary.accounts_summary|length > 1 %}
<h3 style="margin: 15px 0 10px 0; font-size: 13px; color: #333; border-bottom: 1px solid #ccc; padding-bottom: 5px;">ACCOUNTS SUMMARY</h3>

<table>
    <thead>
        <tr>
            <th style="width: 10%;">Code</th>
            <th style="width: 25%;">Account</th>
            <th style="width: 12%;">Type</th>
            <th style="width: 13%;" class="text-right">Opening</th>
            <th style="width: 13%;" class="text-right">Debits</th>
            <th style="width: 13%;" class="text-right">Credits</th>
            <th style="width: 14%;" class="text-right">Closing</th>
        </tr>
    </thead>
    <tbody>
        {% for acc in summary.accounts_summary %}
        <tr>
            <td style="font-size: 9px; font-family: monospace;">{{ acc.account_code }}</td>
            <td>{{ acc.account_name }}</td>
            <td>{{ acc.account_type }}</td>
            <td class="text-right">{{ "%.2f"|format(acc.opening_balance) }}</td>
            <td class="text-right" style="color: #059669;">{{ "%.2f"|format(acc.total_debit) }}</td>
            <td class="text-right" style="color: #dc2626;">{{ "%.2f"|format(acc.total_credit) }}</td>
            <td class="text-right" style="font-weight: bold;">{{ "%.2f"|format(acc.closing_balance) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

<!-- Ledger Entries -->
<h3 style="margin: 15px 0 10px 0; font-size: 13px; color: #333; border-bottom: 1px solid #ccc; padding-bottom: 5px;">LEDGER ENTRIES</h3>

{% if entries %}
<table>
    <thead>
        <tr>
            <th style="width: 10%;">Date</th>
            <th style="width: 20%;">Account</th>
            <th style="width: 28%;">Description</th>
            <th style="width: 10%;">Ref</th>
            <th style="width: 12%;" class="text-right">Debit</th>
            <th style="width: 12%;" class="text-right">Credit</th>
            <th style="width: 12%;" class="text-right">Balance</th>
        </tr>
    </thead>
    <tbody>
        {% set current_account_id = None %}
        {% for entry in entries %}
        {% if not selected_account and current_account_id != entry.account_id and loop.index > 1 %}
        {# Separator row when account changes #}
        <tr style="background-color: #f0f0f0;">
            <td colspan="7" style="padding: 3px 10px;"></td>
        </tr>
        {% endif %}
        {% set current_account_id = entry.account_id %}
        
        <tr style="{% if entry.is_opening %}background-color: #e0f2fe;{% endif %}">
            <td>{{ entry.transaction_date or '-' }}</td>
            <td style="font-size: 9px;">
                {{ entry.account_code }} {{ entry.account_name }}
            </td>
            <td style="{% if entry.is_opening %}font-style: italic;{% endif %}">
                {{ (entry.description or '-')[:40] }}{% if entry.description and entry.description|length > 40 %}...{% endif %}
                {% if entry.is_opening %}<span style="font-size: 8px; color: #666;"> (Opening)</span>{% endif %}
            </td>
            <td>{{ (entry.reference or '-')[:10] }}</td>
            <td class="text-right" style="{% if entry.debit > 0 %}color: #059669;{% endif %}">
                {% if entry.debit > 0 %}{{ "%.2f"|format(entry.debit) }}{% else %}-{% endif %}
            </td>
            <td class="text-right" style="{% if entry.credit > 0 %}color: #dc2626;{% endif %}">
                {% if entry.credit > 0 %}{{ "%.2f"|format(entry.credit) }}{% else %}-{% endif %}
            </td>
            <td class="text-right" style="font-weight: bold; color: {% if entry.balance > 0 %}#059669{% elif entry.balance < 0 %}#dc2626{% else %}#333{% endif %};">
                {{ "%.2f"|format(entry.balance) }}
            </td>
        </tr>
        {% endfor %}
        <tr class="total-row">
            <td colspan="4" class="text-right"><strong>Totals</strong></td>
            <td class="text-right"><strong style="color: #059669;">{{ "%.2f"|format(summary.total_debit) }}</strong></td>
            <td class="text-right"><strong style="color: #dc2626;">{{ "%.2f"|format(summary.total_credit) }}</strong></td>
            <td class="text-right"><strong>{{ "%.2f"|format(summary.net_movement) }}</strong></td>
        </tr>
    </tbody>
</table>
{% else %}
<p style="text-align: center; color: #888; margin: 20px 0;">No ledger entries found for the selected criteria.</p>
{% endif %}
{% endblock %}
