{% extends "dashboard_layout.html" %}

{% block page_title %}{{ 'Edit Product' if product else 'New Product' }}{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700">
        <div class="p-6 border-b border-gray-100 dark:border-gray-700">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white">{{ 'Edit Product' if product else 'Add New Product' }}</h2>
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">{{ 'Update product information' if product else 'Create a new product' }}</p>
        </div>
        
        <form method="POST" action="{{ url_for('inventory.edit_product', product_id=product.get('id')) if product else url_for('inventory.new_product') }}" class="p-6 space-y-6">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            
            {% if error %}
            <div class="p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg dark:bg-red-200 dark:text-red-800" role="alert">
                {{ error }}
            </div>
            {% endif %}
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Product Name *</label>
                    <input type="text" name="name" id="name" required value="{{ product.get('name', '') if product else '' }}" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-primary-500 focus:border-primary-500">
                </div>
                
                <div>
                    <label for="sku" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">SKU</label>
                    <input type="text" name="sku" id="sku" value="{{ product.get('sku', '') if product else '' }}" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-primary-500 focus:border-primary-500">
                </div>
                
                <div>
                    <label for="category_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Category</label>
                    <select name="category_id" id="category_id"
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-primary-500 focus:border-primary-500">
                        <option value="">Select Category</option>
                        {% for cat in categories %}
                        <option value="{{ cat.get('id', cat.id) if cat is mapping else cat.id }}" {{ 'selected' if product and (product.get('category_id') == (cat.get('id', cat.id) if cat is mapping else cat.id)) }}>{{ cat.get('name', cat.name) if cat is mapping else cat.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label for="unit" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Unit</label>
                    <select name="unit" id="unit" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-primary-500 focus:border-primary-500">
                        <option value="pcs" {{ 'selected' if product and product.get('unit') == 'pcs' }}>Pieces</option>
                        <option value="kg" {{ 'selected' if product and product.get('unit') == 'kg' }}>Kilograms</option>
                        <option value="l" {{ 'selected' if product and product.get('unit') == 'l' }}>Liters</option>
                        <option value="m" {{ 'selected' if product and product.get('unit') == 'm' }}>Meters</option>
                        <option value="box" {{ 'selected' if product and product.get('unit') == 'box' }}>Box</option>
                    </select>
                </div>
                
                <div>
                    <label for="purchase_price" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Purchase Price</label>
                    <input type="number" name="purchase_price" id="purchase_price" step="0.01" value="{{ product.get('purchase_price', 0) if product else '0' }}" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-primary-500 focus:border-primary-500">
                </div>
                
                <div>
                    <label for="sales_price" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Sales Price</label>
                    <input type="number" name="sales_price" id="sales_price" step="0.01" value="{{ product.get('sales_price', 0) if product else '0' }}" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-primary-500 focus:border-primary-500">
                </div>
                
                {% if not product %}
                <div>
                    <label for="opening_stock" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Opening Stock</label>
                    <input type="number" name="opening_stock" id="opening_stock" step="0.01" value="0" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-primary-500 focus:border-primary-500">
                </div>
                {% else %}
                <div>
                    <label for="stock_quantity" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Current Stock</label>
                    <input type="number" name="stock_quantity" id="stock_quantity" step="0.01" value="{{ product.get('stock_quantity', 0) }}" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-primary-500 focus:border-primary-500">
                    <p class="text-xs text-gray-500 mt-1">Use Stock Adjustments for inventory tracking</p>
                </div>
                {% endif %}
                
                <div>
                    <label for="reorder_level" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Reorder Level</label>
                    <input type="number" name="reorder_level" id="reorder_level" step="0.01" value="{{ product.get('reorder_level', 0) if product else '0' }}" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-primary-500 focus:border-primary-500">
                </div>
                
                <div class="md:col-span-2">
                    <label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description</label>
                    <textarea name="description" id="description" rows="3" 
                        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-primary-500 focus:border-primary-500">{{ product.get('description', '') if product else '' }}</textarea>
                </div>
            </div>
            
            <div class="flex items-center justify-end space-x-4 pt-4 border-t border-gray-100 dark:border-gray-700">
                <a href="{{ url_for('inventory.list_products') }}" class="px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white font-medium">Cancel</a>
                <button type="submit" class="px-6 py-2 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-xl transition">
                    {{ 'Update Product' if product else 'Add Product' }}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
